# jcourse_client
## 跨平台的选课社区客户端
## 开发文档
### 1.简介
一个基于Qt框架的跨平台选课社区客户端，和[SJTU选课社区](https://course.sjtu.plus)共用后端接口。
### 2.基本架构
模块化开发，界面与软件逻辑分离，易于维护与拓展。
### 3.软件运行逻辑
1. 登录逻辑
    
    选课社区服务器使用OAuth身份认证，过程如下：
    
    1. 客户端向服务器发送带有账号密码的POST请求，服务器返回一个cookies，其中包含 两个字段:csrftoken和sessionid
    2. 客户端只需要在请求头中加上cookies，cookies中包含上述两个字段和对应的值，向选课社区api发送GET请求，服务器返回对应的信息。

    一方面，由于服务器返回的cookies存在过期时间，客户端无法长期使用同一个cookies访问服务器资源；另一方面，用户每次打开客户端都向服务器发送一遍账号密码，并更新cookies是不必要的，也是不安全的。因此，客户端需要妥善维护用户的账号密码信息，既保证不过于频繁地更新cookies，又保证访问服务器资源的有效性。

    客户端维护用户信息的方式如下：
    1. 启动软件时，从文件中读入用户的账号、密码和cookies（如果文件不存在则上述字段为空）
    2. 1的情形下，如果用户账号、密码为空，说明用户未登录，弹出登录窗口，如果用户拒绝登录，退出软件。
    3. 2的情形下，用户登录成功后，向服务器发送带有账号密码的POST请求，更新cookies，短期内将使用更新后的cookies访问资源
    4. 1的情形下，如果用户账号、密码不为空，说明用户已登录，直接进入软件。
    5. 4的情形下，使用现有的cookies向服务器请求资源，如果请求失败，先更新cookies。如果更新cookies失败，说明当前账号或密码错误，弹出登录窗口，如果用户拒绝登录，退出软件。如果更新cookies成功，说明之前访问失败的原因是cookies过期，使用更新后的cookies重新访问资源即可。
    6. 在弹出登录窗口之前客户端的操作应该对用户不可见。
    
### 4.类和函数
项目中的类分为两种： Client和以MainWindow为代表的窗口类。

Client类有两大功能：存储运行数据和执行业务逻辑。
* 存储运行数据：存储软件必要的数据，如用户的账号、密码等，软件启动时会从外部文件读入数据，软件关闭时会将数据写入文件。
* 执行业务逻辑：所有与业务逻辑有关的函数都是Client的成员函数，例如网络包的收发与解析。

以MainWindow为代表的窗口类对象与Client对象通过信号槽连接，在界面上显示出必要的内容。

项目中的函数接口如下：
